<!--
Citation for the following code:
Date: 09/05/2024
Authors: Rami Albaroudi and Mohamed Saud, Group 13
Original work with some Jinja expressions adapted from https://github.com/osu-cs340-ecampus/flask-starter-app?tab=readme-ov-file#dynamically-displaying-data-in-a-template
-->

{% extends "template.j2" %}

{% block title %}Foods{% endblock %}

{% block content %}

<h3>Foods Listing</h3>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Type</th>
            <th>Calories Per Gram</th>
            <th>Note</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        {% for food in foods %}
        <tr id="food-{{ food.foodID }}">
            <td>{{ food.foodID }}</td>
            <td>{{ food.foodName }}</td>
            <td>{{ food.foodType }}</td>
            <td>{{ food.foodCaloriesPerGram }}</td>
            <td>{{ food.foodNote }}</td>
            <td>
                <button onclick="editFood({{ food.foodID }})">Edit</button>
            </td>
            <td>
                <button onclick="confirmDelete({{ food.foodID }})">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Add Food</h3>
<form method="POST" action="/add_food">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Calories Per Gram</th>
                <th>Note</th>
                <th>Add</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" id="addFoodName" name="foodName" required></td>
                <td>
                    <select id="foodType" name="foodType" required>
                        <option value="Fruits">Fruits</option>
                        <option value="Vegetables">Vegetables</option>
                        <option value="Seafood">Seafood</option>
                        <option value="Dairy">Dairy</option>
                        <option value="Mushrooms">Mushrooms</option>
                        <option value="Grains">Grains</option>
                        <option value="Meat">Meat</option>
                        <option value="Spices">Spices</option>
                        <option value="Nuts">Nuts</option>
                        <option value="Greens">Greens</option>
                        <option value="Sweets">Sweets</option>
                        <option value="Oils and Sauces">Oils and Sauces</option>
                        <option value="Beverages">Beverages</option>
                        <option value="Alcohol">Alcohol</option>
                        <option value="Soups">Soups</option>
                        <option value="Baked Products">Baked Products</option>
                        <option value="Fast Foods">Fast Foods</option>
                        <option value="Meals and Recipes">Meals and Recipes</option>
                        <option value="Other">Other</option>
                    </select>
                </td>
                <td><input type="number" id="addFoodCaloriesPerGram" name="foodCaloriesPerGram" step="0.01" required>
                </td>
                <td><input type="text" id="addFoodNote" name="foodNote"></td>
                <td><button type="submit">Add</button></td>
            </tr>
        </tbody>
    </table>
</form>

<script>
    function editFood(foodID) {
        let row = document.getElementById('food-' + foodID);
        let cells = row.getElementsByTagName('td');

        let name = cells[1].innerText;
        let type = cells[2].innerText;
        let caloriesPerGram = cells[3].innerText;
        let note = cells[4].innerText;

        cells[1].innerHTML = '<input type="text" value="' + name + '">';
        cells[2].innerHTML = `<select>
                            <option value="Fruits">Fruits</option>
                            <option value="Vegetables">Vegetables</option>
                            <option value="Seafood">Seafood</option>
                            <option value="Dairy">Dairy</option>
                            <option value="Mushrooms">Mushrooms</option>
                            <option value="Grains">Grains</option>
                            <option value="Meat">Meat</option>
                            <option value="Spices">Spices</option>
                            <option value="Nuts">Nuts</option>
                            <option value="Greens">Greens</option>
                            <option value="Sweets">Sweets</option>
                            <option value="Oils and Sauces">Oils and Sauces</option>
                            <option value="Beverages">Beverages</option>
                            <option value="Alcohol">Alcohol</option>
                            <option value="Soups">Soups</option>
                            <option value="Baked Products">Baked Products</option>
                            <option value="Fast Foods">Fast Foods</option>
                            <option value="Meals and Recipes">Meals and Recipes</option>
                            <option value="Other">Other</option>
                          </select>`;
        cells[3].innerHTML = '<input type="number" step="0.01" value="' + caloriesPerGram + '">';
        cells[4].innerHTML = '<input type="text" value="' + note + '">';
        cells[5].innerHTML = '<button onclick="updateFood(' + foodID + ')">Update</button>';
    }

    function updateFood(foodID) {
        let row = document.getElementById('food-' + foodID);
        let cells = row.getElementsByTagName('td');

        // Get the updated values from the input fields
        let name = cells[1].getElementsByTagName('input')[0].value;
        let type = cells[2].getElementsByTagName('select')[0].value;
        let caloriesPerGram = cells[3].getElementsByTagName('input')[0].value;
        let note = cells[4].getElementsByTagName('input')[0].value;

        // Update the table cells with the new values
        cells[1].innerHTML = name;
        cells[2].innerHTML = type;
        cells[3].innerHTML = caloriesPerGram;
        cells[4].innerHTML = note;
        cells[5].innerHTML = '<button onclick="editFood(' + foodID + ')">Edit</button>';

        // TODO: Implement the logic to send the updated data to the server and update the database
    }

    function confirmDelete(foodID) {
        if (confirm('Are you sure you want to delete this record?')) {
            // TODO: Implement the logic to delete the record from the database
        }
    }
</script>

{% endblock %}