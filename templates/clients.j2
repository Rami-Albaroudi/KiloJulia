<!--
Citation for the following code:
Date: 09/05/2024
Authors: Rami Albaroudi and Mohamed Saud, Group 13
Original work with some Jinja expressions adapted from https://github.com/osu-cs340-ecampus/flask-starter-app?tab=readme-ov-file#dynamically-displaying-data-in-a-template
-->

{% extends "template.j2" %}

{% block title %}Clients{% endblock %}

{% block content %}

<h3>Clients Listing</h3>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Sex</th>
            <th>Age</th>
            <th>Height (cm)</th>
            <th>Weight (kg)</th>
            <th>Activity Level</th>
            <th>Calorie Target</th>
            <th>Note</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        {% for client in clients %}
        <tr id="client-{{ client.clientID }}">
            <td>{{ client.clientID }}</td>
            <td>{{ client.clientName }}</td>
            <td>{{ client.clientEmail }}</td>
            <td>{{ client.clientSex }}</td>
            <td>{{ client.clientAge }}</td>
            <td>{{ client.clientHeight }}</td>
            <td>{{ client.clientWeight }}</td>
            <td>{{ client.clientActivityLevel }}</td>
            <td>{{ client.clientCalorieTarget }}</td>
            <td>{{ client.clientNote }}</td>
            <td>
                <button onclick="editClient({{ client.clientID }})">Edit</button>
            </td>
            <td>
                <button onclick="confirmDelete({{ client.clientID }})">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Add Client</h3>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Sex</th>
            <th>Age</th>
            <th>Height (cm)</th>
            <th>Weight (kg)</th>
            <th>Activity Level</th>
            <th>Calorie Target</th>
            <th>Note</th>
            <th>Add</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="text" id="addClientName" name="clientName" required></td>
            <td><input type="email" id="addClientEmail" name="clientEmail" required></td>
            <td>
                <select id="addClientSex" name="clientSex" required>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </td>
            <td><input type="number" id="addClientAge" name="clientAge" required></td>
            <td><input type="number" id="addClientHeight" name="clientHeight" step="0.1" required></td>
            <td><input type="number" id="addClientWeight" name="clientWeight" step="0.1" required></td>
            <td>
                <select id="addClientActivityLevel" name="clientActivityLevel" required>
                    <option value="Sedentary">Sedentary</option>
                    <option value="Light">Light</option>
                    <option value="Moderate">Moderate</option>
                    <option value="High">High</option>
                    <option value="Athlete">Athlete</option>
                </select>
            </td>
            <td><input type="number" id="addClientCalorieTarget" name="clientCalorieTarget" required></td>
            <td><input type="text" id="addClientNote" name="clientNote"></td>
            <td><button type="submit">Add</button></td>
        </tr>
    </tbody>
</table>

<script>
    function editClient(clientID) {
        let row = document.getElementById('client-' + clientID);
        let cells = row.getElementsByTagName('td');

        let name = cells[1].innerText;
        let email = cells[2].innerText;
        let sex = cells[3].innerText;
        let age = cells[4].innerText;
        let height = cells[5].innerText;
        let weight = cells[6].innerText;
        let activityLevel = cells[7].innerText;
        let calorieTarget = cells[8].innerText;
        let note = cells[9].innerText;

        cells[1].innerHTML = '<input type="text" value="' + name + '">';
        cells[2].innerHTML = '<input type="email" value="' + email + '">';
        cells[3].innerHTML = '<select><option value="Male">Male</option><option value="Female">Female</option></select>';
        cells[4].innerHTML = '<input type="number" value="' + age + '">';
        cells[5].innerHTML = '<input type="number" step="0.1" value="' + height + '">';
        cells[6].innerHTML = '<input type="number" step="0.1" value="' + weight + '">';
        cells[7].innerHTML = `<select>
                            <option value="Sedentary">Sedentary</option>
                            <option value="Light">Light</option>
                            <option value="Moderate">Moderate</option>
                            <option value="High">High</option>
                            <option value="Athlete">Athlete</option>
                          </select>`;
        cells[8].innerHTML = '<input type="number" value="' + calorieTarget + '">';
        cells[9].innerHTML = '<input type="text" value="' + note + '">';
        cells[10].innerHTML = '<button onclick="updateClient(' + clientID + ')">Update</button>';
    }

    function updateClient(clientID) {
        let row = document.getElementById('client-' + clientID);
        let cells = row.getElementsByTagName('td');

        // Get the updated values from the input fields
        let name = cells[1].getElementsByTagName('input')[0].value;
        let email = cells[2].getElementsByTagName('input')[0].value;
        let sex = cells[3].getElementsByTagName('select')[0].value;
        let age = cells[4].getElementsByTagName('input')[0].value;
        let height = cells[5].getElementsByTagName('input')[0].value;
        let weight = cells[6].getElementsByTagName('input')[0].value;
        let activityLevel = cells[7].getElementsByTagName('select')[0].value;
        let calorieTarget = cells[8].getElementsByTagName('input')[0].value;
        let note = cells[9].getElementsByTagName('input')[0].value;

        // Update the table cells with the new values
        cells[1].innerHTML = name;
        cells[2].innerHTML = email;
        cells[3].innerHTML = sex;
        cells[4].innerHTML = age;
        cells[5].innerHTML = height;
        cells[6].innerHTML = weight;
        cells[7].innerHTML = activityLevel;
        cells[8].innerHTML = calorieTarget;
        cells[9].innerHTML = note;
        cells[10].innerHTML = '<button onclick="editClient(' + clientID + ')">Edit</button>';

        // TODO: Implement the logic to send the updated data to the server and update the database
    }

    function confirmDelete(clientID) {
        if (confirm('Are you sure you want to delete this record?')) {
            // TODO: Implement the logic to delete the record from the database
        }
    }
</script>

{% endblock %}